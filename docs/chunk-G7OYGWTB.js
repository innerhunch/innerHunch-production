import{a as V,b as m,c as q,d as R,e as D,f as G,g as A,l as z,n as Y}from"./chunk-P6JN6CVS.js";import{a as N,b as T}from"./chunk-U5BXTOFB.js";import{D as g,F as w,G as l,K as o,L as r,M as p,N as b,O as x,P as C,Q as h,R as v,T as M,U as s,V as P,W as y,aa as S,ga as L,ia as O,n as d,na as E,p as u,pa as U,q as f,qa as I,ua as k,va as F,w as a,z as _}from"./chunk-2NQ3PINK.js";function H(t,i){t&1&&(o(0,"small"),s(1,"Email is required"),r())}function J(t,i){t&1&&(o(0,"small"),s(1,"Invalid email format"),r())}function K(t,i){if(t&1&&(o(0,"div",14),g(1,H,2,0,"small",15)(2,J,2,0,"small",15),r()),t&2){let e=v();a(),l("ngIf",e.email==null||e.email.errors==null?null:e.email.errors.required),a(),l("ngIf",e.email==null||e.email.errors==null?null:e.email.errors.email)}}function Q(t,i){t&1&&(b(0),p(1,"i",16),x())}function W(t,i){t&1&&p(0,"i",17)}function X(t,i){t&1&&(o(0,"small"),s(1,"Password is required"),r())}function Z(t,i){t&1&&(o(0,"small"),s(1,"Min 6 characters"),r())}function $(t,i){if(t&1&&(o(0,"div",14),g(1,X,2,0,"small",15)(2,Z,2,0,"small",15),r()),t&2){let e=v();a(),l("ngIf",e.password==null||e.password.errors==null?null:e.password.errors.required),a(),l("ngIf",e.password==null||e.password.errors==null?null:e.password.errors.minlength)}}var j=class t{fb=d(z);apiService=d(F);router=d(U);route=d(E);loginForm=this.fb.group({email:["",[m.required,m.email]],password:["",[m.required,m.minLength(6)]]});isLoading=!1;errorMessage="";successMessage="";showPassword=!1;returnUrl="/articles";ngOnInit(){this.route.queryParams.subscribe(i=>{i.returnUrl?(this.returnUrl=decodeURIComponent(i.returnUrl),console.log("Decoded returnUrl:",this.returnUrl),this.errorMessage="Please login to access that page."):this.returnUrl="/articles",i.sessionExpired&&(this.errorMessage="Your session has expired. Please login again.")}),this.apiService.isLoggedIn()&&this.router.navigate(["/articles"])}onSubmit(){if(this.loginForm.markAllAsTouched(),this.loginForm.valid){this.isLoading=!0,this.errorMessage="",this.successMessage="";let i={email:this.loginForm.value.email,password:this.loginForm.value.password};console.log("\u{1F510} Attempting login with:",i),this.apiService.login(i).subscribe({next:e=>{this.isLoading=!1,console.log("\u{1F510} Full login response:",e),e.token?(this.successMessage=e.message||"Login successful!",console.log("\u2705 Login successful, token received:",e.token?"YES":"NO"),console.log("\u2705 User data received:",e.user?"YES":"NO"),setTimeout(()=>{console.log("\u{1F510} Checking localStorage after login:"),console.log("\u{1F510} authToken:",localStorage.getItem("authToken")),console.log("\u{1F510} currentUser:",localStorage.getItem("currentUser")),console.log("\u{1F510} ApiService.isLoggedIn():",this.apiService.isLoggedIn()),this.router.navigateByUrl(this.returnUrl)},100)):(this.errorMessage="No token received from server",console.error("\u274C No token in response:",e))},error:e=>{this.isLoading=!1,console.error("\u274C Login error:",e),e.error&&typeof e.error=="string"?this.errorMessage=e.error:e.error&&e.error.message?this.errorMessage=e.error.message:this.errorMessage="Login failed. Please try again."}})}}togglePasswordVisibility(){this.showPassword=!this.showPassword}get email(){return this.loginForm.get("email")}get password(){return this.loginForm.get("password")}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=_({type:t,selectors:[["app-user-login"]],decls:31,vars:11,consts:[["eyeOff",""],[1,"login-container"],[3,"ngSubmit","formGroup"],["type","email","formControlName","email","placeholder","Enter your email"],["class","error",4,"ngIf"],[1,"password-field"],[1,"password-input-wrapper"],["formControlName","password","placeholder","Enter your password","aria-describedby","passwordHelp",3,"type"],["type","button",1,"toggle-password",3,"click"],[4,"ngIf","ngIfElse"],[1,"server-message"],["type","submit",3,"disabled"],[1,"switch-auth"],["routerLink","/signup"],[1,"error"],[4,"ngIf"],[1,"fa-solid","fa-eye-slash"],[1,"fa-solid","fa-eye"]],template:function(e,n){if(e&1){let c=C();p(0,"app-navbar"),o(1,"div",1)(2,"h2"),s(3,"Login"),r(),o(4,"form",2),h("ngSubmit",function(){return u(c),f(n.onSubmit())}),o(5,"div")(6,"label"),s(7,"Email"),r(),p(8,"input",3),g(9,K,3,2,"div",4),r(),p(10,"br"),o(11,"div",5)(12,"label"),s(13,"Password"),r(),o(14,"div",6),p(15,"input",7),o(16,"div",8),h("click",function(){return u(c),f(n.togglePasswordVisibility())}),g(17,Q,2,0,"ng-container",9)(18,W,1,0,"ng-template",null,0,S),r()(),g(20,$,3,2,"div",4),r(),o(21,"span",10),s(22),r(),o(23,"button",11),s(24),r()(),p(25,"br"),o(26,"p",12),s(27," Don't have an account? "),o(28,"a",13),s(29,"Sign-up here"),r()()(),p(30,"app-footer")}if(e&2){let c=M(19);a(4),l("formGroup",n.loginForm),a(5),l("ngIf",(n.email==null?null:n.email.touched)&&(n.email==null?null:n.email.invalid)),a(6),l("type",n.showPassword?"text":"password"),a(),w("aria-pressed",n.showPassword)("aria-label",n.showPassword?"Hide password":"Show password"),a(),l("ngIf",!n.showPassword)("ngIfElse",c),a(3),l("ngIf",(n.password==null?null:n.password.touched)&&(n.password==null?null:n.password.invalid)),a(2),P(n.errorMessage),a(),l("disabled",n.loginForm.invalid||n.isLoading),a(),y(" ",n.isLoading?"Logging in...":"Login"," ")}},dependencies:[O,L,Y,D,V,q,R,G,A,N,T,k,I],styles:["button[_ngcontent-%COMP%]{margin-top:15px;width:100%;padding:10px;border:none;background:var(--app-lightGreen-color);color:#fff;font-size:16px;border-radius:8px;cursor:pointer}.login-container[_ngcontent-%COMP%]{max-width:400px;margin:40px auto;padding:20px;border-radius:12px;box-shadow:0 4px 10px #0000001a;background:#fff;font-family:var(--app-headingFont)}h2[_ngcontent-%COMP%]{text-align:center;margin-bottom:20px}input[_ngcontent-%COMP%]{width:100%;padding:10px;margin-top:6px;border:1px solid #ccc;border-radius:8px}.password-input-wrapper[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding-right:44px}.password-field[_ngcontent-%COMP%]   .password-input-wrapper[_ngcontent-%COMP%]{position:relative}.toggle-password[_ngcontent-%COMP%]{position:absolute;right:1%;top:50%;transform:translateY(-40%);border:none;background:transparent;cursor:pointer;padding:6px;border-radius:6px;display:inline-flex;align-items:center;justify-content:center}.toggle-password[_ngcontent-%COMP%]:focus{outline:2px solid rgba(0,120,212,.25);outline-offset:2px}button[type=submit][_ngcontent-%COMP%]{margin-top:15px;width:100%;padding:10px;border:none;background:var(--app-lightGreen-color);color:#fff;font-size:16px;border-radius:8px;cursor:pointer}button[_ngcontent-%COMP%]:disabled{background:#aaa;cursor:not-allowed}button[_ngcontent-%COMP%]:hover:enabled{background:var(--app-darkGreen-color)}.error[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:red}.switch-auth[_ngcontent-%COMP%]{text-align:center;margin-top:15px;font-size:14px}.switch-auth[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--app-darkGreen-color);text-decoration:none;font-weight:700}.switch-auth[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.loading[_ngcontent-%COMP%]{color:#666;text-align:center;margin-top:10px}.success[_ngcontent-%COMP%]{color:green;text-align:center;margin-top:10px}.server-message[_ngcontent-%COMP%]{display:block;text-align:center;margin-top:10px;color:red;font-size:12px}"]})};export{j as UserLoginComponent};
